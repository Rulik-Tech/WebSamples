<!DOCTYPE html>
<html lang="en-US">
 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rulik WebSamples</title>
</head>

<body>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        // This will set up document.body dimentions
        document.body.style.width = "100vw";
        document.body.style.height = "100vh";
        document.body.style.margin=0;        
        document.body.style.background = "Gray";
        document.body.style.overflow = 'hidden';
        document.body.style.textAlign = "center";

        var ul = document.createElement('ul');
        ul.style.marginTop = "100px";
        ul.style.display = "inline-block";

        var liArr = [];
        for (let i = 0; i < 3; i++) {
            let li = document.createElement('li');
            li.style.listStyleType = "none"; // Remove dots
            li.style.textAlign = "center";
            li.style.margin = "30px"            
            ul.appendChild(li);
            liArr.push(li);
        }        

        document.body.appendChild(ul);        

        var demoMode = false;        
        function toggleDemoMode(){
            if(demoMode){
                demoMode = false;
                stopDemo();
            } else {
                demoMode = true;
                startDemo();
            }
        }

        function startDemo() {
            btn.textContent = "Exit Demo";
            startOrientationTracking();
        }                                

        function stopDemo() {
            stopOrientationTracking();
            lbl.textContent = "Press button to start demo";
            btn.textContent = "Start Demo";
        }

        // Create Label
        var lbl = document.createElement("Label");
        lbl.style.display = "inline-block";
        lbl.style.height = '60px';
        lbl.style.width = '240px';
        lbl.style.fontSize = '24px';
        lbl.style.border= "medium solid black"; // width | style | color 
        lbl.style.borderRadius = "10px";
        liArr[0].appendChild(lbl);

        // Create canvas area
        var canvas = document.createElement("Canvas");
        canvas.style.borderRadius = "10px";        
        canvas.style.border = "medium solid black";
        liArr[1].appendChild(canvas);

        var btn = document.createElement("Button");
        btn.style.display = "inline-block";
        btn.style.background = 'DeepSkyBlue';
        btn.style.color = 'white';
        btn.style.height = '60px';
        btn.style.width = '240px';
        btn.style.fontSize = '24px';
        btn.style.borderRadius = "10px";
        btn.style.border= "medium solid black"; // width | style | color 

        btn.addEventListener("click", toggleDemoMode);
        btn.textContent = "Start Demo";
        
        liArr[2].appendChild(btn);

        function onResize() {
            // Simple detection of protrait / landscape orientation
            if (document.body.clientWidth > document.body.clientHeight){ // Landscape mode
                for (let i = 0; i < liArr.length; i++) {
                    liArr[i].style.float = "left";
                }
                canvas.width = document.body.clientHeight * 0.7;
            } else { // Portrait mode
                for (let i = 0; i < liArr.length; i++) {
                    liArr[i].style.float = "none";
                } 
                canvas.width = document.body.clientWidth * 0.7;                
            }
            
            canvas.height = canvas.width;
            drawBars(0, 0, 0);
            lbl.textContent = document.body.clientWidth.toString()+ " " + document.body.clientHeight.toString();
        }

        onResize();

        //window.addEventListener('beforeShow', onResize, false);
        window.addEventListener("resize", onResize, false);        
        

        function drawBars(frontToBack, leftToRight, rotateDegrees) {
            // leftToRight -90 <> 90
            const lr = leftToRight / 90.0;
            const fb = frontToBack / 90.0;
            const centerX = canvas.width/2 - 5;
            const centerY = canvas.height/2 - 5;
            const ctx = canvas.getContext("2d");            
            ctx.fillStyle = "Gray";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "blue";
            ctx.fillRect(centerX + centerX*lr, centerY + centerY*fb, 10, 10);                        
        }        

        function getAccelerometerPermissions(){
            if (window.DeviceOrientationEvent) {
                lbl.textContent = "Step 6"
                DeviceMotionEvent.requestPermission().then(response => {
                    if (response == 'granted') {
                        lbl.textContent = "Orientation is availanle";
                        lbl.textContent = "Step 7"
                        startOrientationTracking();
                    }
                });
            } else {
                lbl.textContent = "Orientation not availanle";
            }
        }

        function orientationEventHandler(event){
            const rotateDegrees = event.alpha.toFixed(0); // alpha: rotation around z-axis
            const frontToBack = event.beta.toFixed(0); // beta: front back motion
            const leftToRight = event.gamma.toFixed(0); // gamma: left to right            
            lbl.textContent = frontToBack + "\t" + leftToRight + "\t" +  rotateDegrees;
            drawBars(frontToBack, leftToRight, rotateDegrees);            
        }

        function startOrientationTracking(){
            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", orientationEventHandler, true);
            } else {
                lbl.textContent = "Orientation not availanle";                
            }
        }

        function stopOrientationTracking(){
            if (window.DeviceOrientationEvent) {
                window.removeEventListener("deviceorientation", orientationEventHandler, true);    
            } else {
                lbl.textContent = "Orientation not availanle";                
            }
        }

        lbl.textContent = "v1.2: " + lbl.textContent;

    </script>
</body>
</html>
