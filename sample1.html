<!DOCTYPE html>
<html lang="en-US">
 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rulik WebSamples</title>
</head>

<body>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        var browser = "Uknown";
        if(navigator.userAgent.indexOf("Chrome") != -1 ){
            browser = "Chrome";
        } else if(navigator.userAgent.indexOf("Safari") != -1) {
            browser = "Safari";
        }
        // This will set up document.body dimentions
        document.body.style.width = "100%";
        //document.body.style.height = "100vh";
        document.body.style.margin=0;
        document.body.style.display="inline-block";
        document.body.style.background = "Gray";

        var infoSection = document.createElement("Section");
        infoSection.style.width = "100%";
        //infoSection.style.height = "7%";
        infoSection.style.display = "inline-block";
        infoSection.style.marginTop = "5%"
        //infoSection.style.background = "Red";
        infoSection.style.textAlign =  "center";

        document.body.appendChild(infoSection);

        var mainSection = document.createElement("Section");
        mainSection.style.width = "100%";
        //mainSection.style.height = "70%";
        mainSection.style.textAlign =  "center";
        mainSection.style.display = "inline-block";        
        //mainSection.style.background = "Green";        

        document.body.appendChild(mainSection);

        var controlSection = document.createElement("Section");
        controlSection.style.width = "100%";
        //controlSection.style.height = "33%";
        controlSection.style.display = "inline-block";
        //controlSection.style.background = "Blue";
        controlSection.style.textAlign =  "center";
        
        document.body.appendChild(controlSection);

        var fullScreen = false;        
        function toggleFullScreen(){
            if(fullScreen){
                fullScreen = false;
                closeFullscreen();
            } else {
                fullScreen = true;
                openFullscreen();
            }
        }

        function openFullscreen() {
            btn.textContent = "Exit Demo";
            /*
            if(browser.localeCompare("Safari") == 0){
                lbl.textContent = "Step 5";
                getAccelerometerPermissions();
            } else {
                lbl.textContent = "Step 4"
                var myScreenOrientation = window.screen.orientation;
                myScreenOrientation.lock("portrait");
                lbl.textContent = "Step 5"
                startOrientationTracking();
            }
            */
            startOrientationTracking();
        }                                

        function closeFullscreen() {
            stopOrientationTracking();
            lbl.textContent = "Press button to start demo";
            btn.textContent = "Start Demo";
        }

        var canvas = document.createElement("Canvas");
        canvas.style.borderRadius = "10px";
        canvas.style.display = "inline-block";
        canvas.style.borderStyle = "solid";
        canvas.style.borderBlockColor = "Black";
        canvas.style.borderWidth = "2px"        
        mainSection.appendChild(canvas);

        function onResize() {
            const size = Math.min(document.body.clientWidth, document.body.clientHeight);
            canvas.width  = size;
            canvas.height = size;
            drawBars(0, 0, 0);
        }

        window.addEventListener('beforeShow', onResize, false);
        window.addEventListener("resize", onResize);        
        
        var btn = document.createElement("Button");
        btn.style.background = 'DeepSkyBlue';
        btn.style.color = 'white';
        btn.style.fontSize = '24px';
        btn.style.borderRadius = "10px";
        btn.style.visibility = 'visible';
        btn.style.display = "inline-block";
        btn.style.margin = "5%";
        btn.addEventListener("click", toggleFullScreen);
        btn.textContent = "Start Demo";

        controlSection.appendChild(btn);
        onResize();

        var lbl = document.createElement("Label");        
        lbl.style.width = "90%";        
        lbl.style.display = "inline-block";        
        lbl.style.margin = "10px";
        lbl.style.fontSize = '24px'        
        
        infoSection.appendChild(lbl);

        function drawBars(frontToBack, leftToRight, rotateDegrees) {
            // leftToRight -90 <> 90
            const lr = leftToRight / 90.0;
            const fb = frontToBack / 90.0;
            const centerX = canvas.width/2 -5;
            const centerY = canvas.height/2 -5;
            const ctx = canvas.getContext("2d");            
            ctx.fillStyle = "Gray";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "blue";
            ctx.fillRect(centerX + centerX*lr, centerY + centerY*fb, 10, 10);                        
        }        

        function getAccelerometerPermissions(){
            if (window.DeviceOrientationEvent) {
                lbl.textContent = "Step 6"
                DeviceMotionEvent.requestPermission().then(response => {
                    if (response == 'granted') {
                        lbl.textContent = "Orientation is availanle";
                        lbl.textContent = "Step 7"
                        startOrientationTracking();
                    }
                });
            } else {
                lbl.textContent = "Orientation not availanle";
            }
        }

        function orientationEventHandler(event){
            const rotateDegrees = event.alpha.toFixed(0); // alpha: rotation around z-axis
            const frontToBack = event.beta.toFixed(0); // beta: front back motion
            const leftToRight = event.gamma.toFixed(0); // gamma: left to right            
            lbl.textContent = frontToBack + "\t" + leftToRight + "\t" +  rotateDegrees;
            drawBars(frontToBack, leftToRight, rotateDegrees);            
        }

        orientationEventHandler({alpha: 10, beta:-20, gamma:0});

        // mousemoveHandler
        function startOrientationTracking(){
            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", orientationEventHandler, true);
            } else {
                lbl.textContent = "Orientation not availanle";                
            }
        }

        function stopOrientationTracking(){
            if (window.DeviceOrientationEvent) {
                window.removeEventListener("deviceorientation", orientationEventHandler, true);    
            } else {
                lbl.textContent = "Orientation not availanle";                
            }
        }

        lbl.textContent = browser + " v1.0: " + lbl.textContent;
        
    </script>
</body>
</html>
